# ya-goph-keeper-server

Сервер используемый для синхронизации и хранения данных.<br/>
(Proto [keeper proto](https://github.com/Puena/ya-goph-keeper-proto))<br/>
(Client [keeper client](https://github.com/Puena/ya-goph-keeper-client))

Данные хранятся в зашифрованном веде. Шифрование происходит на клиенте, у сервера нет возможнсти для доступа к данными клиента.

### Приложение использует
- grpc для обмена сообщениями
- grpc gzip для сжатия сообщений
- jwt аутентификация 
- citus extension for Postgresql для хранения данных, citus используется для разделения таблиц по user_id (distributed tables).

### Особенности синхронизации
Локально извлекаем все последние события(например было создание,изменение,удаление, то последним событием будет удаление) для каждого сундука, после чего полученные данные отправляем на сервер. На сервере происходит тоже самое извлекаются все последние события для каждого сундука, после чего начинается процесс сравнивания последних оперций для каждого сундука. Алгоритм сравнения слудующий: Если локальное событие выполнено позже синхронизированного события, то локально событие добавляется в результат, если обратное то в результат будет добавлено синхронизированное событие. Также если локального события нет на сервере, то оно добавляется в результат и если собтия с сервера нет в локальных оно добаляется в результат. После результат возвращается на клиент. Клиент проходит по таблице событий и запрашивает данные в случае если событие создание/изменение, и удаляет данные в случае если событие удаление. Код отвечающий за синхронизацию на клиенте находится в функции
func (u *keeperUseCases) Sync(ctx context.Context, history []*dto.History, userID uuid.UUID) ([]*dto.History, error)
